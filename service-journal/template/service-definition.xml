<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE server PUBLIC
  "-//Nimbus//DTD Nimbus 1.0//JA"
  "http://nimbus.sourceforge.jp/dtd/nimbus-service_1_0.dtd">

<server>
    
    <default-log>
        <debug output="false"/>
        <information output="false"/>
        <warning output="true"/>
        <error output="true"/>
        <fatal output="true"/>
    </default-log>

    <manager name="Template.Service.Journal.AccessJournal">

        <manager-property name="Template.Service.Journal.AccessJournal.LOG_OUTPUT_PATH">.</manager-property>
        <manager-property name="Template.Service.Journal.AccessJournal.SEPARATOR">,</manager-property>

<!--=======================================================================
ジャーナルサービス
========================================================================-->
        <!-- アクセスジャーナル -->
        <service name="AccessJournal"
                 template="Template.Service.Journal#Journal"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME" extends="true">#AccessJournalEditorFinder</service-property>
            <service-property name="Template.Service.Journal.QUEUE_SERVICE_NAME">#AccessJournalQueue</service-property>
            
            <attribute name="WritableElementKey">Access</attribute>
            <attribute name="CategoryServiceNames">
                #AccessNormalJournalCategory
                #AccessErrorJournalCategory
            </attribute>
            <depends>AccessNormalJournalCategory</depends>
            <depends>AccessErrorJournalCategory</depends>
        </service>

        <service name="AccessJournalQueue"
                 template="Template.Service.Queue#DefaultQueue"
                 instance="template">
            
            <service-property name="Template.Service.Journal.AccessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">1000</service-property>
            
<ifdef name="Template.Service.Journal.AccessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">
            <attribute name="MaxThresholdSize">${Template.Service.Journal.AccessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE}</attribute>
</ifdef>
        </service>

<!--=======================================================================
カテゴリサービス
========================================================================-->

        <service name="AccessNormalJournalCategory"
                 template="Template.Service.Writer.Category#SimpleCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessNormalJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessNormalJournalWriter</service-property>
        </service>

        <!-- アクセスエラージャーナルカテゴリ -->
        <service name="AccessErrorJournalCategory"
                 template="Template.Service.Writer.Category#EvaluateCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessErrorJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessErrorJournalWriter</service-property>
            <attribute name="WritableConditions">
                @Access.JournalRecords.Request[0].JournalRecords.Exception[0]@!=null or @Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Exception[0]@!=null
            </attribute>
        </service>


<!--=======================================================================
WritableRecordFactoryサービス
========================================================================-->
        <!-- アクセスジャーナルのフォーマッタ -->
        <service name="AccessNormalJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                CLIENT_IP=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RemoteAddress
                SESSION_ID=Access.JournalRecords.Response[0].JournalRecords.HttpSession[0].ID
                REQUEST_URL=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RequestURL
                REQUEST_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Request[0].JournalRecords.{{RequestBytes[0]}|{RequestObject[0].Bytes(UTF-8)}}
                RESPONSE_STATUS=Access.JournalRecords.Response[0].JournalRecords.ServletResponse[0].Status
                RESPONSE_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Response[0].JournalRecords.ResponseBytes[0]
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">%DATE%${Template.Service.Journal.AccessJournal.SEPARATOR}%REQUEST_ID%${Template.Service.Journal.AccessJournal.SEPARATOR}%CLIENT_IP%${Template.Service.Journal.AccessJournal.SEPARATOR}%SESSION_ID%${Template.Service.Journal.AccessJournal.SEPARATOR}%REQUEST_URL%${Template.Service.Journal.AccessJournal.SEPARATOR}%REQUEST_OBJ%${Template.Service.Journal.AccessJournal.SEPARATOR}%RESPONSE_STATUS%${Template.Service.Journal.AccessJournal.SEPARATOR}%RESPONSE_OBJ%${Template.Service.Journal.AccessJournal.SEPARATOR}%PERFORMANCE%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#AccessNormalDateElement
                REQUEST_OBJ=#CSVElement
                RESPONSE_OBJ=#CSVElement
            </attribute>
            <depends>AccessNormalDateElement</depends>
            <depends>CSVElement</depends>
        </service>

        <service name="AccessNormalDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyy/MM/dd HH:mm:ss.SSS</attribute>
        </service>

        <service name="CSVElement"
                 template="Template.Service.Writer.WritableRecordFactory#LineElement"
                 instance="template">
            <attribute name="Trim">true</attribute>
            <attribute name="StringConverter"><service-ref>#CustomConverter</service-ref></attribute>
            <depends>CustomConverter</depends>
        </service>

        <service name="CustomConverter"
                 code="jp.ossc.nimbus.util.converter.CustomConverter"
                 instance="template">
            <invoke name="add">
                <argument type="jp.ossc.nimbus.util.converter.Converter">
                    <service-ref>#CSVEscapeConverter</service-ref>
                </argument>
            </invoke>
            <depends>#CSVEscapeConverter</depends>
        </service>

        <service name="CSVEscapeConverter"
                 code="jp.ossc.nimbus.io.CSVWriter"
                 instance="template">
            <attribute name="Enclose">true</attribute>
            <attribute name="Separator">${Template.Service.Journal.AccessJournal.SEPARATOR}</attribute>
        </service>

        <!-- アクセスエラージャーナルのフォーマッタ -->
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                CLIENT_IP=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RemoteAddress
                SESSION_ID=Access.JournalRecords.Response[0].JournalRecords.HttpSession[0].ID
                REQUEST_URL=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RequestURL
                REQUEST_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Request[0].JournalRecords.{{RequestBytes[0]}|{RequestObject[0].Bytes(UTF-8)}}
                RESPONSE_STATUS=Access.JournalRecords.Response[0].JournalRecords.ServletResponse[0].Status
                PERFORMANCE=Access.Performance
                RESPONSE_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Response[0].JournalRecords.ResponseBytes[0]
                EXCEPTION=Access.JournalRecords.Request[0].JournalRecords.{{Exception[0]}|{Exchange[0].JournalRecords.Exception[0]}}
            </attribute>
            <attribute name="Format">時刻=%DATE%${line.separator}リクエスト通番=%REQUEST_ID%${line.separator}クライアントIP=%CLIENT_IP%${line.separator}セッションID=%SESSION_ID%${line.separator}リクエストURL=%REQUEST_URL%${line.separator}リクエストオブジェクト=%REQUEST_OBJ%${line.separator}HTTPステータス=%RESPONSE_STATUS%${line.separator}レスポンス=%RESPONSE_OBJ%${line.separator}処理時間=%PERFORMANCE%${line.separator}発生例外=%EXCEPTION%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#AccessErrorDateElement
                REQUEST_OBJ=#ErrorSimpleElement
                RESPONSE_OBJ=#ErrorSimpleElement
            </attribute>
            <depends>AccessErrorDateElement</depends>
            <depends>ErrorSimpleElement</depends>
        </service>

        <service name="AccessErrorDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyyMMddHHmmssSSS</attribute>
        </service>

        <service name="ErrorSimpleElement"
                 template="Template.Service.Writer.WritableRecordFactory#SimpleElement"
                 instance="template"/>

<!--=======================================================================
ライターサービス
========================================================================-->
        <!-- アクセスジャーナル書き込みサービス -->
        <service name="AccessNormalJournalWriter"
                 template="Template.Service.Writer.MessageWriter.Log4J#CustomizedRollingFileWriter"
                 instance="template">
            <attribute name="Append">true</attribute>
            <attribute name="BufferedIO">false</attribute>
            <attribute name="File">${Template.Service.Journal.AccessJournal.LOG_OUTPUT_PATH}/accessjournal%INDEX%.log</attribute>
            <attribute name="ImmediateFlush">true</attribute>
            <attribute name="Header"></attribute>
            <attribute name="MaximumFileSize">10485760</attribute>
            <attribute name="MaxBackupIndex">100</attribute>
        </service>

        <!-- アクセスエラージャーナル書き込みサービス -->
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Writer.MessageWriter#FileWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.AccessJournal.LOG_OUTPUT_PATH}/error-journal/accessjournal-error</attribute>
            <attribute name="FilePostfix">_%DATE%_%REQUEST_ID%.log</attribute>
        </service>

<!--=======================================================================
EditorFinderサービス
========================================================================-->

        <!-- アクセスジャーナルに必要な型に対応するJournalEditorサービスを検索するEditorFinderサービス -->
        <service name="AccessJournalEditorFinder"
                 template="Template.Service.Journal.EditorFinder#ObjectMappedEditorFinder"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME" extends="true">#AccessJournalEditorProperties</service-property>
            
        </service>
        
        <service name="AccessJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.BYTE_ARRAY_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ByteArrayJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.HTTP_SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#HttpServletRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.HTTP_SESSION_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#HttpSessionMapJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.JOURNAL_HTTP_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ServletResponseJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#AccessRequestJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectArrayJournalEditor</service-property>
            
<ifdef name="Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.lang.String[])">${Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
            
        </service>

<!--=======================================================================
Editorサービス
========================================================================-->
        <!-- ジャーナルに出力するオブジェクトをジャーナル文字列へと変換するJournalEditorサービス群 -->
        <service name="AccessRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#SimpleRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputRequestId">true</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputRecords">true</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MutableObjectJournalEditor"
                 instance="template"/>

        <service name="ObjectArrayJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ObjectArrayJournalEditor"
                 instance="template"/>

        <service name="ByteArrayJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ByteArrayJournalEditor"
                 instance="template">
            <attribute name="ConvertMode">UTF-8</attribute>
        </service>

        <service name="HttpServletRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#HttpServletRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputRemoteAddress">true</attribute>
            <attribute name="OutputRemotePort">false</attribute>
            <attribute name="OutputRemoteHost">false</attribute>
            <attribute name="OutputLocalAddress">false</attribute>
            <attribute name="OutputLocalPort">false</attribute>
            <attribute name="OutputLocalName">false</attribute>
            <attribute name="OutputServerName">false</attribute>
            <attribute name="OutputServerPort">false</attribute>
            <attribute name="OutputProtocol">false</attribute>
            <attribute name="OutputScheme">false</attribute>
            <attribute name="OutputLocale">false</attribute>
            <attribute name="OutputContentType">false</attribute>
            <attribute name="OutputContentLength">false</attribute>
            <attribute name="OutputCharacterEncoding">false</attribute>
            <attribute name="OutputAttributes">false</attribute>
            <attribute name="SecretAttributes"></attribute>
            <attribute name="EnabledAttributes"></attribute>
            <attribute name="OutputParameters">true</attribute>
            <attribute name="SecretParameters"></attribute>
            <attribute name="EnabledParameters"></attribute>
            <attribute name="OutputRequestURL">true</attribute>
            <attribute name="OutputRequestURI">false</attribute>
            <attribute name="OutputServletPath">false</attribute>
            <attribute name="OutputContextPath">false</attribute>
            <attribute name="OutputPathInfo">false</attribute>
            <attribute name="OutputPathTranslated">false</attribute>
            <attribute name="OutputQueryString">false</attribute>
            <attribute name="OutputSessionID">true</attribute>
            <attribute name="OutputIsRequestedSessionIdFromCookie">true</attribute>
            <attribute name="OutputIsRequestedSessionIdFromURL">false</attribute>
            <attribute name="OutputMethod">false</attribute>
            <attribute name="OutputAuthType">false</attribute>
            <attribute name="OutputRemoteUser">false</attribute>
            <attribute name="OutputUserPrincipal">false</attribute>
            <attribute name="OutputHeaders">false</attribute>
            <attribute name="SecretHeaders"></attribute>
            <attribute name="EnabledHeaders"></attribute>
            <attribute name="OutputCookies">false</attribute>
            <attribute name="SecretCookies"></attribute>
            <attribute name="EnabledCookies"></attribute>
        </service>

        <service name="ServletResponseJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#HttpServletResponseWrapperMapJournalEditor"
                 instance="template">
            <attribute name="OutputBufferSize">false</attribute>
            <attribute name="OutputCharacterEncoding">false</attribute>
            <attribute name="OutputContentType">false</attribute>
            <attribute name="OutputLocale">false</attribute>
            <attribute name="OutputIsCommitted">false</attribute>
            <attribute name="OutputContentLength">false</attribute>
            <attribute name="OutputContent">true</attribute>
            <attribute name="OutputHeaders">false</attribute>
            <attribute name="OutputCookies">false</attribute>
            <attribute name="OutputStatus">true</attribute>
            <attribute name="OutputStatusMessage">false</attribute>
            <attribute name="OutputIsSentError">false</attribute>
            <attribute name="OutputRedirectLocation">false</attribute>
            <attribute name="SecretHeaders"></attribute>
            <attribute name="EnabledHeaders"></attribute>
            <attribute name="SecretCookies"></attribute>
            <attribute name="EnabledCookies"></attribute>
        </service>

        <service name="HttpSessionMapJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#HttpSessionMapJournalEditor"
                 instance="template">
            <attribute name="OutputId">true</attribute>
            <attribute name="OutputCreationTime">false</attribute>
            <attribute name="OutputLastAccessedTime">false</attribute>
            <attribute name="OutputMaxInactiveInterval">false</attribute>
            <attribute name="OutputAttributes">true</attribute>
            <attribute name="OutputIsNew">false</attribute>
        </service>

        <service name="ThrowableJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ThrowableJournalEditor"
                 instance="template"/>

    </manager>

    <manager name="Template.Service.Journal.AccessJournal.JSON">
        
        <service name="AccessNormalJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                CLIENT_IP=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RemoteAddress
                SESSION_ID=Access.JournalRecords.Response[0].JournalRecords.HttpSession[0].ID
                REQUEST_URL=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RequestURL
                REQUEST_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Request[0].JournalRecords.{{RequestBytes[0]}|{RequestObject[0].Bytes(UTF-8)}}
                RESPONSE_STATUS=Access.JournalRecords.Response[0].JournalRecords.ServletResponse[0].Status
                RESPONSE_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Response[0].JournalRecords.ResponseBytes[0]
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","ipAddress":"%CLIENT_IP%","sessionId":"%SESSION_ID%","url":"%REQUEST_URL%","request":%REQUEST_OBJ%,"statusCode":%RESPONSE_STATUS%,"response":%RESPONSE_OBJ%,"performance":%PERFORMANCE%}</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#AccessNormalDateElement
                REQUEST_OBJ=#JSONElement
                RESPONSE_OBJ=#JSONElement
            </attribute>
            <depends>AccessNormalDateElement</depends>
            <depends>JSONElement</depends>
            <depends>JSONEscapeElement</depends>
        </service>
        
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                CLIENT_IP=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RemoteAddress
                SESSION_ID=Access.JournalRecords.Response[0].JournalRecords.HttpSession[0].ID
                REQUEST_URL=Access.JournalRecords.Request[0].JournalRecords.ServletRequest[0].RequestURL
                REQUEST_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Request[0].JournalRecords.{{RequestBytes[0]}|{RequestObject[0].Bytes(UTF-8)}}
                RESPONSE_STATUS=Access.JournalRecords.Response[0].JournalRecords.ServletResponse[0].Status
                PERFORMANCE=Access.Performance
                RESPONSE_OBJ=Access.JournalRecords.Request[0].JournalRecords.Exchange[0].JournalRecords.Response[0].JournalRecords.ResponseBytes[0]
                EXCEPTION=Access.JournalRecords.Request[0].JournalRecords.{{Exception[0]}|{Exchange[0].JournalRecords.Exception[0]}}
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","ipAddress":"%CLIENT_IP%","sessionId":"%SESSION_ID%","url":"%REQUEST_URL%","request":%REQUEST_OBJ%,"statusCode":%RESPONSE_STATUS%,"response":%RESPONSE_OBJ%,"performance":%PERFORMANCE%,"exception":"%EXCEPTION%"}</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#AccessNormalDateElement
                REQUEST_OBJ=#JSONElement
                RESPONSE_OBJ=#JSONElement
                EXCEPTION=#JSONEscapeElement
            </attribute>
            <depends>AccessNormalDateElement</depends>
            <depends>JSONElement</depends>
            <depends>JSONEscapeElement</depends>
        </service>
        
        <service name="JSONElement"
                 template="Template.Service.Writer.WritableRecordFactory#LineElement"
                 instance="template">
            <attribute name="Trim">true</attribute>
        </service>
        
        <service name="JSONEscapeElement"
                 template="Template.Service.Writer.WritableRecordFactory#SimpleElement"
                 instance="template">
            <attribute name="StringConverter"><service-ref>#JSONEscapeElementConverter</service-ref></attribute>
            <depends>JSONEscapeElementConverter</depends>
        </service>
        
        <service name="JSONEscapeElementConverter"
                 code="jp.ossc.nimbus.util.converter.JSONEscapeConverter"
                 instance="template">
            <attribute name="UnicodeEscape">false</attribute>
        </service>
        
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Writer.MessageWriter.Log4J#CustomizedRollingFileWriter"
                 instance="template">
            <attribute name="Append">true</attribute>
            <attribute name="BufferedIO">false</attribute>
            <attribute name="File">${Template.Service.Journal.AccessJournal.LOG_OUTPUT_PATH}/accessjournal-error%INDEX%.log</attribute>
            <attribute name="ImmediateFlush">true</attribute>
            <attribute name="Header"></attribute>
            <attribute name="MaximumFileSize">10485760</attribute>
            <attribute name="MaxBackupIndex">100</attribute>
        </service>
    </manager>

    <manager name="Template.Service.Journal.BusinessJournal">

        <manager-property name="Template.Service.Journal.BusinessJournal.LOG_OUTPUT_PATH">.</manager-property>
        <manager-property name="Template.Service.Journal.BusinessJournal.JOURNAL_ENABLED">true</manager-property>
        <manager-property name="Template.Service.Journal.JournalEditor.INDENT">${\t}</manager-property>
        <manager-property name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">true</manager-property>

<!--=======================================================================
ジャーナルサービス
========================================================================-->
        <!-- Businessジャーナル -->
        <service name="BusinessJournal"
                 template="Template.Service.Journal#Journal"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME" extends="true">#BusinessJournalEditorFinder</service-property>
            <service-property name="Template.Service.Journal.QUEUE_SERVICE_NAME">#BusinessJournalQueue</service-property>
            
            <attribute name="WritableElementKey">Business</attribute>
            <attribute name="CategoryServiceNames">
                #BusinessJournalCategory
                #BusinessErrorJournalCategory
            </attribute>
            <depends>BusinessJournalCategory</depends>
            <depends>BusinessErrorJournalCategory</depends>
        </service>

        <service name="BusinessJournalQueue"
                 template="Template.Service.Queue#DefaultQueue"
                 instance="template">
            
            <service-property name="Template.Service.Journal.BusinessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">1000</service-property>
            
<ifdef name="Template.Service.Journal.BusinessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">
            <attribute name="MaxThresholdSize">${Template.Service.Journal.BusinessJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE}</attribute>
</ifdef>
        </service>

<!--=======================================================================
カテゴリサービス
========================================================================-->
        <!-- Businessジャーナルカテゴリ -->
        <service name="BusinessJournalCategory"
                 template="Template.Service.Writer.Category#EvaluateCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#BusinessJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#BusinessJournalWriter</service-property>
            <attribute name="Enabled">${Template.Service.Journal.BusinessJournal.JOURNAL_ENABLED}</attribute>
            <attribute name="WritableConditions">
                @Business.JournalRecords.Flow[0]@!=null or @Business.JournalRecords.Action[0].JournalRecords.Request[0].JournalRecords.Flow[0]@!=null or @Business.JournalRecords.Validate[0].JournalRecords.Request[0].JournalRecords.Flow[0]@!=null
            </attribute>
        </service>

        <!-- Businessエラージャーナルカテゴリ -->
        <service name="BusinessErrorJournalCategory"
                 template="Template.Service.Writer.Category#EvaluateCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#BusinessErrorJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#BusinessErrorJournalWriter</service-property>
            <attribute name="Enabled">true</attribute>
            <attribute name="WritableConditions">
                @Business.JournalRecords.Exception[0]@!=null or @Business.JournalRecords.Action[0].JournalRecords.Request[0].JournalRecords.Exception[0]@!=null or @Business.JournalRecords.Validate[0].JournalRecords.Request[0].JournalRecords.Exception[0]@!=null
            </attribute>
        </service>

<!--=======================================================================
WritableRecordFactoryサービス
========================================================================-->
        <!-- Businessジャーナルのフォーマッタ -->
        <service name="BusinessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                ACTION_FLOW=Business.JournalRecords.{{Flow[0]}|{Action[0].JournalRecords.Request[0].JournalRecords.Flow[0]}|{Validate[0].JournalRecords.Request[0].JournalRecords.Flow[0]}}
            </attribute>
            <attribute name="Format">*****************************************${line.separator}%ACTION_FLOW%</attribute>
        </service>

        <!-- Businessエラージャーナルのフォーマッタ -->
        <service name="BusinessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Business.StartTime
                REQUEST_ID=Business.RequestID
                ACTION_FLOW=Business.JournalRecords.{{Flow[0]}|{Action[0].JournalRecords.Request[0].JournalRecords.Flow[0]}|{Validate[0].JournalRecords.Request[0].JournalRecords.Flow[0]}}
                EXCEPTION=Business.JournalRecords.{{Exception[0]}|{Action[0].JournalRecords.Request[0].JournalRecords.Exception[0]}|{Validate[0].JournalRecords.Request[0].JournalRecords.Exception[0]}}
            </attribute>
            <attribute name="Format">
                時刻=%DATE%${line.separator}リクエスト通番=%REQUEST_ID%${line.separator}発生例外:%EXCEPTION%${line.separator}BeanFlowトレース:${line.separator}Action=%ACTION_FLOW%
            </attribute>
            <attribute name="ImplementServiceNames">
                DATE=#ErrorDateElement
                EXCEPTION=#ErrorThrowableElement
            </attribute>
            <depends>ErrorDateElement</depends>
            <depends>ErrorThrowableElement</depends>
        </service>

        <service name="ErrorDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyyMMddHHmmssSSS</attribute>
        </service>

        <service name="ErrorThrowableElement"
                 template="Template.Service.Writer.WritableRecordFactory#ThrowableElement"
                 instance="template">
            <attribute name="OutputCause">true</attribute>
        </service>

<!--=======================================================================
ライターサービス
========================================================================-->
        <!-- Businessジャーナル書き込みサービス -->
        <service name="BusinessJournalWriter"
                 template="Template.Service.Writer.MessageWriter.Log4J#CustomizedRollingFileWriter"
                 instance="template">
            <attribute name="Append">true</attribute>
            <attribute name="BufferedIO">false</attribute>
            <attribute name="File">${Template.Service.Journal.BusinessJournal.LOG_OUTPUT_PATH}/businessjournal%INDEX%.log</attribute>
            <attribute name="ImmediateFlush">true</attribute>
            <attribute name="Header"></attribute>
            <attribute name="MaximumFileSize">10485760</attribute>
            <attribute name="MaxBackupIndex">100</attribute>
        </service>

        <!-- Businessエラージャーナル書き込みサービス -->
        <service name="BusinessErrorJournalWriter"
                 template="Template.Service.Writer.MessageWriter#FileWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.BusinessJournal.LOG_OUTPUT_PATH}/error-journal/businessjournal-error</attribute>
            <attribute name="FilePostfix">_%DATE%_%REQUEST_ID%.log</attribute>
        </service>

<!--=======================================================================
EditorFinderサービス
========================================================================-->

        <!-- 業務ジャーナルに必要な型に対応するJournalEditorサービスを検索するEditorFinderサービス -->
        <service name="BusinessJournalEditorFinder"
                 template="Template.Service.Journal.EditorFinder#ObjectMappedEditorFinder"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME" extends="true">#BusinessJournalEditorProperties</service-property>
        </service>
        
        <service name="BusinessJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MutableObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MapRequestJournalEditor</service-property>
        </service>

        <!-- 業務フロージャーナルに必要な型に対応するJournalEditorサービスを検索するEditorFinderサービス -->
        <service name="BeanFlowJournalEditorFinder"
                 template="Template.Service.Journal.EditorFinder#ObjectMappedEditorFinder"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME" extends="true">#BeanFlowJournalEditorProperties</service-property>
            
        </service>
        
        <service name="BeanFlowJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#DateJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.LIST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ListJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#StepRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#DataSetJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.HEADER_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#HeaderJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.RECORD_LIST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#RecordListJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.RECORD_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#RecordJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#FlowRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ExecuteRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#BeanJournalEditor</service-property>
            
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.RequestJournal,Flow)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.RequestJournal,Execute)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.servlet.BeanFlowServletContext)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
        </service>

<!--=======================================================================
Editorサービス
========================================================================-->
        <!-- ジャーナルに出力するオブジェクトをジャーナル文字列へと変換するJournalEditorサービス群 -->
        <service name="BusinessRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#SimpleRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputRequestId">true</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputRecords">true</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">false</attribute>
        </service>

        <service name="MutableObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MutableObjectJournalEditor"
                 instance="template"/>

        <service name="MapRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#SimpleRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputJournalKey">false</attribute>
            <attribute name="OutputRequestId">true</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputRecords">true</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">false</attribute>
        </service>

        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ObjectJournalEditor"
                 instance="template">
            <attribute name="MaxArrayLength">10</attribute>
        </service>

        <service name="ClassJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ClassJournalEditor"
                 instance="template">
            <attribute name="ShortClassName">true</attribute>
        </service>

        <service name="DateJournalEditor"
                 template="Template.Service.Journal.JournalEditor#DateJournalEditor"
                 instance="template">
            <attribute name="Format">yyyy/MM/dd HH:mm:ss.SSS</attribute>
        </service>

        <service name="ListJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ListJournalEditor"
                 instance="template">
            <attribute name="MaxSize">10</attribute>
        </service>

        <service name="FlowRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor#SimpleRequestJournalEditor"
                 instance="template">
            <attribute name="OutputHeader">false</attribute>
            <attribute name="OutputRequestId">false</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputEndTime">true</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="StepRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor#SimpleRequestJournalEditor"
                 instance="template">
            <attribute name="OutputHeader">false</attribute>
            <attribute name="OutputRequestId">false</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputEndTime">true</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="ExecuteRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor#SimpleRequestJournalEditor"
                 instance="template">
            <attribute name="OutputHeader">false</attribute>
            <attribute name="OutputRequestId">false</attribute>
            <attribute name="OutputStartTime">false</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="ThrowableJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ThrowableJournalEditor"
                 instance="template"/>

        <service name="DataSetJournalEditor"
                 template="Template.Service.Journal.JournalEditor#DataSetJournalEditor"
                 instance="template"/>

        <service name="RecordJournalEditor"
                 template="Template.Service.Journal.JournalEditor#RecordJournalEditor"
                 instance="template">
            <attribute name="OutputCSVProperties">true</attribute>
            <attribute name="SecretProperties">password</attribute>
            <attribute name="SecretString">****</attribute>
        </service>

        <service name="HeaderJournalEditor"
                 template="Template.Service.Journal.JournalEditor#HeaderJournalEditor"
                 instance="template">
            <attribute name="OutputCSVProperties">true</attribute>
            <attribute name="SecretProperties">password</attribute>
            <attribute name="SecretString">****</attribute>
        </service>

        <service name="RecordListJournalEditor"
                 template="Template.Service.Journal.JournalEditor#RecordListJournalEditor"
                 instance="template">
            <attribute name="MaxSize">10</attribute>
        </service>

        <service name="BeanJournalEditor"
                 template="Template.Service.Journal.JournalEditor#BeanJournalEditor"
                 instance="template">
            <attribute name="OutputPropertyType">false</attribute>
            <attribute name="EnabledProperties">
                jp.ossc.nimbus.servlet.BeanFlowServletContext#Input,
                jp.ossc.nimbus.servlet.BeanFlowServletContext#Output
            </attribute>
        </service>

    </manager>

    <manager name="Template.Service.Journal.BusinessJournal.JSON">
        
        <service name="BusinessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                ACTION_FLOW=Business.JournalRecords.{{Flow[0]}|{Action[0].JournalRecords.Request[0].JournalRecords.Flow[0]}|{Validate[0].JournalRecords.Request[0].JournalRecords.Flow[0]}}
            </attribute>
            <attribute name="Format">%ACTION_FLOW%</attribute>
        </service>
        
        <service name="BusinessErrorJournalWritableRecordFactory"
                 template="Template.Service.Journal.BusinessJournal.JSON#BusinessJournalWritableRecordFactory"
                 instance="template"/>
        
        <service name="BusinessErrorJournalWriter"
                 template="Template.Service.Journal.BusinessJournal#BusinessJournalWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.BusinessJournal.LOG_OUTPUT_PATH}/businessjournal-error%INDEX%.log</attribute>
        </service>
        
        <service name="BeanFlowJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#DateJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#StepRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#DataSetJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#FlowRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ExecuteRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#BeanJournalEditor</service-property>
            
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.RequestJournal,Flow)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.FLOW_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.RequestJournal,Execute)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.EXECUTE_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.servlet.BeanFlowServletContext)">${Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.BeanFlowJournal.EditorFinder.BEANFLOW_SERVLET_CONTEXT_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
        </service>
        
        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#JSONJournalEditor"
                 instance="template">
            <attribute name="ExpandArrayValue">true</attribute>
            <attribute name="MaxArraySize">3</attribute>
            <attribute name="ExpandMapValue">true</attribute>
            <attribute name="ExcludeExpandMapClasses">
                jp.ossc.nimbus.service.context.Context
            </attribute>
            <attribute name="SecretProperties">
                password
            </attribute>
        </service>

        <service name="FlowRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#RequestJournalJSONJournalEditor"
                 instance="template">
            <attribute name="DisabledProperties">
                Input
            </attribute>
        </service>
        
        <service name="StepRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#RequestJournalJSONJournalEditor"
                 instance="template">
            <attribute name="DisabledProperties">
                RequestId
            </attribute>
        </service>
        
        <service name="ExecuteRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#RequestJournalJSONJournalEditor"
                 instance="template">
            <attribute name="DisabledProperties">
                RequestId,
                StartTime,
                EndTime
            </attribute>
        </service>
        
        <service name="DataSetJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#DataSetJSONJournalEditor"
                 instance="template">
            <attribute name="SecretProperties">
                password
            </attribute>
        </service>

        <service name="BeanJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#BeanJSONJournalEditor"
                 instance="template">
            <attribute name="EnabledProperties">
                input,
                output
            </attribute>
        </service>
        
    </manager>

    <manager name="Template.Service.Journal.ProxyJournal">

        <manager-property name="Template.Service.Journal.ProxyJournal.LOG_OUTPUT_PATH">.</manager-property>
        <manager-property name="Template.Service.Journal.ProxyJournal.SEPARATOR">,</manager-property>

<!--=======================================================================
ジャーナルサービス
========================================================================-->
        <service name="AccessJournal"
                 template="Template.Service.Journal#Journal"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME" extends="true">#AccessJournalEditorFinder</service-property>
            <service-property name="Template.Service.Journal.QUEUE_SERVICE_NAME">#AccessJournalQueue</service-property>
            
            <attribute name="WritableElementKey">Access</attribute>
            <attribute name="CategoryServiceNames">
                #AccessJournalCategory
                #AccessErrorJournalCategory
            </attribute>
            <depends>AccessJournalCategory</depends>
            <depends>AccessErrorJournalCategory</depends>
        </service>

        <service name="AccessJournalQueue"
                 template="Template.Service.Queue#DefaultQueue"
                 instance="template">
            
            <service-property name="Template.Service.Journal.ProxyJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">1000</service-property>
            
<ifdef name="Template.Service.Journal.ProxyJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">
            <attribute name="MaxThresholdSize">${Template.Service.Journal.ProxyJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE}</attribute>
</ifdef>
        </service>

<!--=======================================================================
カテゴリサービス
========================================================================-->

        <service name="AccessJournalCategory"
                 template="Template.Service.Writer.Category#SimpleCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessJournalWriter</service-property>
        </service>

        <!-- Accessエラージャーナルカテゴリ -->
        <service name="AccessErrorJournalCategory"
                 template="Template.Service.Writer.Category#EvaluateCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessErrorJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessErrorJournalWriter</service-property>
            <attribute name="Enabled">true</attribute>
            <attribute name="WritableConditions">
                @Access.JournalRecords.Exception[0]@!=null
            </attribute>
        </service>

<!--=======================================================================
WritableRecordFactoryサービス
========================================================================-->
        <!-- Accessジャーナルのフォーマッタ -->
        <service name="AccessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                TARGET=Access.JournalRecords.MethodCall[0].Target.ServiceNameObject
                METHOD_NAME=Access.JournalRecords.MethodCall[0].Name
                METHOD_PARAMS=Access.JournalRecords.MethodCall[0].Parameters
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">%DATE%${Template.Service.Journal.ProxyJournal.SEPARATOR}%REQUEST_ID%${Template.Service.Journal.ProxyJournal.SEPARATOR}%TARGET%.%METHOD_NAME%${Template.Service.Journal.ProxyJournal.SEPARATOR}%METHOD_PARAMS%${Template.Service.Journal.ProxyJournal.SEPARATOR}%PERFORMANCE%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#NormalDateElement
                METHOD_PARAMS=#ParametersElement
            </attribute>
            <depends>NormalDateElement</depends>
            <depends>ParametersElement</depends>
        </service>

        <!-- Accessエラージャーナルのフォーマッタ -->
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                TARGET=Access.JournalRecords.MethodCall[0].Target.ServiceNameObject
                METHOD_NAME=Access.JournalRecords.MethodCall[0].Name
                METHOD_PARAMS=Access.JournalRecords.MethodCall[0].Parameters
                PERFORMANCE=Access.Performance
                EXCEPTION=Access.JournalRecords.Exception[0]
            </attribute>
            <attribute name="Format">時刻=%DATE%${line.separator}リクエストID=%REQUEST_ID%${line.separator}呼び出し情報=%TARGET%.%METHOD_NAME%(%METHOD_PARAMS%)${line.separator}処理時間=%PERFORMANCE%[ms]${line.separator}発生例外:${line.separator}%EXCEPTION%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#ErrorDateElement
                METHOD_PARAMS=#ParametersElement
            </attribute>
            <depends>ErrorDateElement</depends>
            <depends>ParametersElement</depends>
        </service>

        <service name="NormalDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyy/MM/dd HH:mm:ss.SSS</attribute>
        </service>

        <service name="ErrorDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyyMMddHHmmssSSS</attribute>
        </service>

        <service name="ParametersElement"
                 template="Template.Service.Writer.WritableRecordFactory#ArrayElement"
                 instance="template">
            <attribute name="StringConverter"><service-ref>#CustomConverter</service-ref></attribute>
            <depends>CustomConverter</depends>
        </service>

        <service name="CustomConverter"
                 code="jp.ossc.nimbus.util.converter.CustomConverter"
                 instance="template">
            <invoke name="add">
                <argument type="jp.ossc.nimbus.util.converter.Converter">
                    <service-ref>#CSVEscapeConverter</service-ref>
                </argument>
            </invoke>
            <depends>#CSVEscapeConverter</depends>
        </service>

        <service name="CSVEscapeConverter"
                 code="jp.ossc.nimbus.io.CSVWriter"
                 instance="template">
            <attribute name="Enclose">true</attribute>
            <attribute name="Separator">${Template.Service.Journal.ProxyJournal.SEPARATOR}</attribute>
        </service>

<!--=======================================================================
ライターサービス
========================================================================-->
        <!-- Accessジャーナル書き込みサービス -->
        <service name="AccessJournalWriter"
                 template="Template.Service.Writer.MessageWriter.Log4J#CustomizedRollingFileWriter"
                 instance="template">
            <attribute name="Append">true</attribute>
            <attribute name="BufferedIO">false</attribute>
            <attribute name="File">${Template.Service.Journal.ProxyJournal.LOG_OUTPUT_PATH}/accessjournal%INDEX%.log</attribute>
            <attribute name="ImmediateFlush">true</attribute>
            <attribute name="Header">""</attribute>
            <attribute name="MaximumFileSize">10485760</attribute>
            <attribute name="MaxBackupIndex">100</attribute>
        </service>

        <!-- Accessエラージャーナル書き込みサービス -->
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Writer.MessageWriter#FileWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.ProxyJournal.LOG_OUTPUT_PATH}/error-journal/accessjournal-error</attribute>
            <attribute name="FilePostfix">_%DATE%.log</attribute>
        </service>


<!--=======================================================================
EditorFinderサービス
========================================================================-->
        <service name="AccessJournalEditorFinder"
                 template="Template.Service.Journal.EditorFinder#ObjectMappedEditorFinder"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME" extends="true">#AccessJournalEditorProperties</service-property>
            
        </service>
        
        <service name="AccessJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MutableObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#AccessRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MethodJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MutableObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MutableObjectJournalEditor</service-property>
        </service>

        <!-- ジャーナルに出力するオブジェクトをジャーナル文字列へと変換するJournalEditorサービス群 -->
        <service name="AccessRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#SimpleRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputRequestId">true</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputRecords">true</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="MutableObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MutableObjectJournalEditor"
                 instance="template"/>

        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ObjectJournalEditor"
                 instance="template"/>

        <service name="ClassJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ClassJournalEditor"
                 instance="template">
            <attribute name="ShortClassName">true</attribute>
        </service>

        <service name="MethodJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MethodJournalEditor"
                 instance="template">
            <attribute name="OutputItemName">false</attribute>
        </service>

        <service name="ThrowableJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ThrowableJournalEditor"
                 instance="template"/>

    </manager>
    
    <manager name="Template.Service.Journal.ProxyJournal.JSON">
        
        <!-- Accessジャーナルのフォーマッタ -->
        <service name="AccessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                METHOD_CALL=Access.JournalRecords.MethodCall[0]
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","call":%METHOD_CALL%,"performance":%PERFORMANCE%}</attribute>
        </service>
        
        <!-- Accessエラージャーナルのフォーマッタ -->
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                METHOD_CALL=Access.JournalRecords.MethodCall[0]
                PERFORMANCE=Access.Performance
                EXCEPTION=Access.JournalRecords.Exception[0]
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","call":%METHOD_CALL%,"performance":%PERFORMANCE%,"exception":"%EXCEPTION%"}</attribute>
            <attribute name="ImplementServiceNames">
                EXCEPTION=#JSONEscapeElement
            </attribute>
            <depends>JSONEscapeElement</depends>
        </service>
        
        <service name="JSONEscapeElement"
                 template="Template.Service.Writer.WritableRecordFactory#SimpleElement"
                 instance="template">
            <attribute name="StringConverter"><service-ref>#JSONEscapeElementConverter</service-ref></attribute>
            <depends>JSONEscapeElementConverter</depends>
        </service>
        
        <service name="JSONEscapeElementConverter"
                 code="jp.ossc.nimbus.util.converter.JSONEscapeConverter"
                 instance="template">
            <attribute name="UnicodeEscape">false</attribute>
        </service>

        <!-- Accessエラージャーナル書き込みサービス -->
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Journal.ProxyJournal#AccessJournalWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.ProxyJournal.LOG_OUTPUT_PATH}/accessjournal-error%INDEX%.log</attribute>
        </service>
        
        <service name="AccessJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#DateJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#AccessRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MethodJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MethodCallJournalJSONJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME">#MethodReturnJournalJSONJournalEditor</service-property>
        </service>
        
        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#BeanJSONJournalEditor"
                 instance="template">
            <attribute name="ExpandArrayValue">true</attribute>
            <attribute name="MaxArraySize">3</attribute>
            <attribute name="ExpandMapValue">true</attribute>
            <attribute name="ExcludeExpandMapClasses">
                jp.ossc.nimbus.service.context.Context
            </attribute>
            <attribute name="SecretProperties">
                password
            </attribute>
        </service>
        
        <service name="DateJournalEditor"
                 template="Template.Service.Journal.JournalEditor#DateJournalEditor"
                 instance="template"/>
        
        <service name="MethodCallJournalJSONJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#MethodCallJournalJSONJournalEditor"
                 instance="template">
            <attribute name="OutputKey">false</attribute>
        </service>
        
        <service name="MethodReturnJournalJSONJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#MethodReturnJournalJSONJournalEditor"
                 instance="template">
            <attribute name="OutputKey">false</attribute>
        </service>
        
    </manager>

    <manager name="Template.Service.Journal.HttpJournal">
        
        <manager-property name="Template.Service.Journal.HttpJournal.LOG_OUTPUT_PATH">.</manager-property>
        <manager-property name="Template.Service.Journal.HttpJournal.SEPARATOR">,</manager-property>

<!--=======================================================================
ジャーナルサービス
========================================================================-->
        <service name="AccessJournal"
                 template="Template.Service.Journal#Journal"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME" extends="true">#AccessJournalEditorFinder</service-property>
            <service-property name="Template.Service.Journal.QUEUE_SERVICE_NAME">#AccessJournalQueue</service-property>
            
            <attribute name="WritableElementKey">Access</attribute>
            <attribute name="CategoryServiceNames">
                #AccessJournalCategory
                #AccessErrorJournalCategory
            </attribute>
            <depends>AccessJournalCategory</depends>
            <depends>AccessErrorJournalCategory</depends>
        </service>

        <service name="AccessJournalQueue"
                 template="Template.Service.Queue#DefaultQueue"
                 instance="template">
            
            <service-property name="Template.Service.Journal.HttpJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">1000</service-property>
            
<ifdef name="Template.Service.Journal.HttpJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE">
            <attribute name="MaxThresholdSize">${Template.Service.Journal.HttpJournal.JOURNAL_QUEUE_MAX_THRESHOLD_SIZE}</attribute>
</ifdef>
        </service>

<!--=======================================================================
カテゴリサービス
========================================================================-->

        <service name="AccessJournalCategory"
                 template="Template.Service.Writer.Category#SimpleCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessJournalWriter</service-property>
        </service>

        <!-- Accessエラージャーナルカテゴリ -->
        <service name="AccessErrorJournalCategory"
                 template="Template.Service.Writer.Category#EvaluateCategory"
                 instance="template">
            <service-property name="Template.Service.Writer.Category.WRITABLE_RECORD_FACTORY_SERVICE_NAME" extends="true">#AccessErrorJournalWritableRecordFactory</service-property>
            <service-property name="Template.Service.Writer.Category.MESSAGE_WRITER_SERVICE_NAME" extends="true">#AccessErrorJournalWriter</service-property>
            <attribute name="Enabled">true</attribute>
            <attribute name="WritableConditions">
                @Access.JournalRecords.Exception[0]@ != null or @Access.JournalRecords.Response[0].JournalRecords.Status[0]@ != 200
            </attribute>
        </service>

<!--=======================================================================
WritableRecordFactoryサービス
========================================================================-->
        <!-- Accessジャーナルのフォーマッタ -->
        <service name="AccessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                URL=Access.JournalRecords.Request[0].JournalRecords.URI[0]
                COOKIES=Access.JournalRecords.Request[0].JournalRecords.Cookies[0]
                HEADERS=Access.JournalRecords.Request[0].JournalRecords.Headers[0]
                PARAMETERS=Access.JournalRecords.Request[0].JournalRecords.Parameters[0]
                BODY=Access.JournalRecords.Request[0].JournalRecords.Body[0]
                STATUS=Access.JournalRecords.Response[0].JournalRecords.Status[0]
                RESPONSE_HEADERS=Access.JournalRecords.Response[0].JournalRecords.Headers[0]
                OUTPUT=Access.JournalRecords.Response[0].JournalRecords.Body[0]
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">%DATE%${Template.Service.Journal.HttpJournal.SEPARATOR}%REQUEST_ID%${Template.Service.Journal.HttpJournal.SEPARATOR}%URL%${Template.Service.Journal.HttpJournal.SEPARATOR}%COOKIES%${Template.Service.Journal.HttpJournal.SEPARATOR}%HEADERS%${Template.Service.Journal.HttpJournal.SEPARATOR}%PARAMETERS%${Template.Service.Journal.HttpJournal.SEPARATOR}%BODY%${Template.Service.Journal.HttpJournal.SEPARATOR}%RESPONSE_HEADERS%${Template.Service.Journal.HttpJournal.SEPARATOR}%OUTPUT%${Template.Service.Journal.HttpJournal.SEPARATOR}%STATUS%${Template.Service.Journal.HttpJournal.SEPARATOR}%PERFORMANCE%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#NormalDateElement
                COOKIES=#CSVElement
                HEADERS=#CSVElement
                PARAMETERS=#CSVElement
                BODY=#CSVElement
                RESPONSE_HEADERS=#CSVElement
                OUTPUT=#CSVElement
            </attribute>
            <depends>NormalDateElement</depends>
            <depends>CSVElement</depends>
        </service>

        <!-- Accessエラージャーナルのフォーマッタ -->
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                URL=Access.JournalRecords.Request[0].JournalRecords.URI[0]
                COOKIES=Access.JournalRecords.Request[0].JournalRecords.Cookies[0]
                HEADERS=Access.JournalRecords.Request[0].JournalRecords.Headers[0]
                PARAMETERS=Access.JournalRecords.Request[0].JournalRecords.Parameters[0]
                BODY=Access.JournalRecords.Request[0].JournalRecords.Body[0]
                STATUS=Access.JournalRecords.Response[0].JournalRecords.Status[0]
                RESPONSE_HEADERS=Access.JournalRecords.Response[0].JournalRecords.Headers[0]
                OUTPUT=Access.JournalRecords.Response[0].JournalRecords.Body[0]
                PERFORMANCE=Access.Performance
                EXCEPTION=Access.JournalRecords.Exception[0]
            </attribute>
            <attribute name="Format">時刻=%DATE%${line.separator}リクエストID=%REQUEST_ID%${line.separator}リクエストURL=%URL%${line.separator}リクエストCookie=%COOKIES%${line.separator}リクエストヘッダ=%HEADERS%${line.separator}リクエストパラメータ=%PARAMETERS%${line.separator}リクエストボディ=%BODY%${line.separator}レスポンスステータス=%STATUS%${line.separator}レスポンスヘッダ=%RESPONSE_HEADERS%${line.separator}出力=%OUTPUT%${line.separator}処理時間=%PERFORMANCE%${line.separator}発生例外=%EXCEPTION%</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#ErrorDateElement
                COOKIES=#CSVElement
                HEADERS=#CSVElement
                PARAMETERS=#CSVElement
                BODY=#CSVElement
                RESPONSE_HEADERS=#CSVElement
                OUTPUT=#CSVElement
            </attribute>
            <depends>NormalDateElement</depends>
            <depends>CSVElement</depends>
        </service>

        <service name="NormalDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyy/MM/dd HH:mm:ss.SSS</attribute>
        </service>

        <service name="ErrorDateElement"
                 template="Template.Service.Writer.WritableRecordFactory#DateElement"
                 instance="template">
            <attribute name="Format">yyyyMMddHHmmssSSS</attribute>
        </service>

        <service name="CSVElement"
                 template="Template.Service.Writer.WritableRecordFactory#LineElement"
                 instance="template">
            <attribute name="Trim">true</attribute>
            <attribute name="StringConverter"><service-ref>#CustomConverter</service-ref></attribute>
            <depends>CustomConverter</depends>
        </service>

        <service name="CustomConverter"
                 code="jp.ossc.nimbus.util.converter.CustomConverter"
                 instance="template">
            <invoke name="add">
                <argument type="jp.ossc.nimbus.util.converter.Converter">
                    <service-ref>#CSVEscapeConverter</service-ref>
                </argument>
            </invoke>
            <depends>#CSVEscapeConverter</depends>
        </service>

        <service name="CSVEscapeConverter"
                 code="jp.ossc.nimbus.io.CSVWriter"
                 instance="template">
            <attribute name="Enclose">true</attribute>
            <attribute name="Separator">${Template.Service.Journal.HttpJournal.SEPARATOR}</attribute>
        </service>

<!--=======================================================================
ライターサービス
========================================================================-->
        <!-- Accessジャーナル書き込みサービス -->
        <service name="AccessJournalWriter"
                 template="Template.Service.Writer.MessageWriter.Log4J#CustomizedRollingFileWriter"
                 instance="template">
            <attribute name="Append">true</attribute>
            <attribute name="BufferedIO">false</attribute>
            <attribute name="File">${Template.Service.Journal.HttpJournal.LOG_OUTPUT_PATH}/accessjournal%INDEX%.log</attribute>
            <attribute name="ImmediateFlush">true</attribute>
            <attribute name="Header">""</attribute>
            <attribute name="MaximumFileSize">10485760</attribute>
            <attribute name="MaxBackupIndex">100</attribute>
        </service>

        <!-- Accessエラージャーナル書き込みサービス -->
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Writer.MessageWriter#FileWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.HttpJournal.LOG_OUTPUT_PATH}/error-journal/accessjournal-error</attribute>
            <attribute name="FilePostfix">_%DATE%.log</attribute>
        </service>


<!--=======================================================================
EditorFinderサービス
========================================================================-->
        <service name="AccessJournalEditorFinder"
                 template="Template.Service.Journal.EditorFinder#ObjectMappedEditorFinder"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME" extends="true">#AccessJournalEditorProperties</service-property>
            
        </service>
        
        <service name="AccessJournalEditorProperties"
                 template="Template.Service.Journal.EditorFinder#EditorProperties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MutableObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ThrowableJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.MAP_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#MapJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#AccessRequestJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME" extends="true">#ObjectArrayJournalEditor</service-property>
            
<ifdef name="Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.lang.String[])">${Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.AccessJournal.EditorFinder.STRING_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
        </service>

        <!-- ジャーナルに出力するオブジェクトをジャーナル文字列へと変換するJournalEditorサービス群 -->
        <service name="AccessRequestJournalEditor"
                 template="Template.Service.Journal.JournalEditor.Map#SimpleRequestMapJournalEditor"
                 instance="template">
            <attribute name="OutputRequestId">true</attribute>
            <attribute name="OutputStartTime">true</attribute>
            <attribute name="OutputRecords">true</attribute>
            <attribute name="OutputEndTime">false</attribute>
            <attribute name="OutputPerformance">true</attribute>
        </service>

        <service name="MutableObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MutableObjectJournalEditor"
                 instance="template"/>

        <service name="ObjectJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ObjectJournalEditor"
                 instance="template"/>

        <service name="ObjectArrayJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ObjectArrayJournalEditor"
                 instance="template"/>

        <service name="MapJournalEditor"
                 template="Template.Service.Journal.JournalEditor#MapJournalEditor"
                 instance="template"/>

        <service name="ThrowableJournalEditor"
                 template="Template.Service.Journal.JournalEditor#ThrowableJournalEditor"
                 instance="template"/>
        
    </manager>

    <manager name="Template.Service.Journal.HttpJournal.JSON">
        
        <!-- Accessジャーナルのフォーマッタ -->
        <service name="AccessJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                URL=Access.JournalRecords.Request[0].JournalRecords.URI[0]
                COOKIES=Access.JournalRecords.Request[0].JournalRecords.Cookies[0]
                HEADERS=Access.JournalRecords.Request[0].JournalRecords.Headers[0]
                PARAMETERS=Access.JournalRecords.Request[0].JournalRecords.Parameters[0]
                BODY=Access.JournalRecords.Request[0].JournalRecords.Body[0]
                STATUS=Access.JournalRecords.Response[0].JournalRecords.Status[0]
                RESPONSE_HEADERS=Access.JournalRecords.Response[0].JournalRecords.Headers[0]
                OUTPUT=Access.JournalRecords.Response[0].JournalRecords.Body[0]
                PERFORMANCE=Access.Performance
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","url":"%URL%","cookies":%COOKIES%,"headers":%HEADERS%,"parameters":%PARAMETERS%,"request":%BODY%,"responseHeaders":%RESPONSE_HEADERS%,"response":%OUTPUT%,"statusCode":%STATUS%,"performance":%PERFORMANCE%}</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#NormalDateElement
                COOKIES=#JSONElement
                HEADERS=#JSONElement
                PARAMETERS=#JSONElement
                BODY=#JSONElement
                RESPONSE_HEADERS=#JSONElement
                OUTPUT=#JSONElement
            </attribute>
            <depends>NormalDateElement</depends>
            <depends>JSONElement</depends>
            <depends>JSONEscapeElement</depends>
        </service>

        <!-- Accessエラージャーナルのフォーマッタ -->
        <service name="AccessErrorJournalWritableRecordFactory"
                 template="Template.Service.Writer.WritableRecordFactory#PropertyWritableRecordFactory"
                 instance="template">
            <attribute name="FormatKeyMapping">
                DATE=Access.StartTime
                REQUEST_ID=Access.RequestID
                URL=Access.JournalRecords.Request[0].JournalRecords.URI[0]
                COOKIES=Access.JournalRecords.Request[0].JournalRecords.Cookies[0]
                HEADERS=Access.JournalRecords.Request[0].JournalRecords.Headers[0]
                PARAMETERS=Access.JournalRecords.Request[0].JournalRecords.Parameters[0]
                BODY=Access.JournalRecords.Request[0].JournalRecords.Body[0]
                STATUS=Access.JournalRecords.Response[0].JournalRecords.Status[0]
                RESPONSE_HEADERS=Access.JournalRecords.Response[0].JournalRecords.Headers[0]
                OUTPUT=Access.JournalRecords.Response[0].JournalRecords.Body[0]
                PERFORMANCE=Access.Performance
                EXCEPTION=Access.JournalRecords.Exception[0]
            </attribute>
            <attribute name="Format">{"timestamp":"%DATE%","requestId":"%REQUEST_ID%","url":"%URL%","cookies":%COOKIES%,"headers":%HEADERS%,"parameters":%PARAMETERS%,"request":%BODY%,"responseHeaders":%RESPONSE_HEADERS%,"response":%OUTPUT%,"statusCode":%STATUS%,"performance":%PERFORMANCE%,"exception":"%EXCEPTION%"}</attribute>
            <attribute name="ImplementServiceNames">
                DATE=#NormalDateElement
                COOKIES=#JSONElement
                HEADERS=#JSONElement
                PARAMETERS=#JSONElement
                BODY=#JSONElement
                RESPONSE_HEADERS=#JSONElement
                OUTPUT=#JSONElement
                EXCEPTION=#JSONEscapeElement
            </attribute>
            <depends>NormalDateElement</depends>
            <depends>JSONElement</depends>
            <depends>JSONEscapeElement</depends>
        </service>
        
        <service name="JSONElement"
                 template="Template.Service.Writer.WritableRecordFactory#LineElement"
                 instance="template">
            <attribute name="Trim">true</attribute>
        </service>
        
        <service name="JSONEscapeElement"
                 template="Template.Service.Writer.WritableRecordFactory#SimpleElement"
                 instance="template">
            <attribute name="StringConverter"><service-ref>#JSONEscapeElementConverter</service-ref></attribute>
            <depends>JSONEscapeElementConverter</depends>
        </service>
        
        <service name="JSONEscapeElementConverter"
                 code="jp.ossc.nimbus.util.converter.JSONEscapeConverter"
                 instance="template">
            <attribute name="UnicodeEscape">false</attribute>
        </service>
        
        <service name="AccessErrorJournalWriter"
                 template="Template.Service.Journal.HttpJournal#AccessJournalWriter"
                 instance="template">
            <attribute name="File">${Template.Service.Journal.HttpJournal.LOG_OUTPUT_PATH}/accessjournal-error%INDEX%.log</attribute>
        </service>

        <service name="MapJournalEditor"
                 template="Template.Service.Journal.JournalEditor.JSON#JSONJournalEditor"
                 instance="template">
            <attribute name="ExpandArrayValue">true</attribute>
            <attribute name="MaxArraySize">3</attribute>
            <attribute name="ExpandMapValue">true</attribute>
            <attribute name="SecretProperties">
                password
            </attribute>
            <attribute name="OutputKey">false</attribute>
        </service>
    </manager>
    
    <manager name="Template.Service.Journal">
        
        <service name="Journal"
                 code="jp.ossc.nimbus.service.journal.ThreadManagedJournalService"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME" extends="true">#Editorfinder</service-property>
            <service-property name="Template.Service.Journal.SEQUENCE_SERVICE_NAME">#Sequence</service-property>
            <service-property name="Template.Service.Journal.QUEUE_SERVICE_NAME">#JournalQueue</service-property>
            <service-property name="Template.Service.Journal.CATEGORY_SERVICE_NAME">#Category</service-property>
            
<ifdef name="Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME">
            <attribute name="EditorFinderName">${Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EDITOR_FINDER_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.SEQUENCE_SERVICE_NAME">
            <attribute name="SequenceServiceName">${Template.Service.Journal.SEQUENCE_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.SEQUENCE_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.QUEUE_SERVICE_NAME">
            <attribute name="QueueServiceName">${Template.Service.Journal.QUEUE_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.QUEUE_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.CATEGORY_SERVICE_NAME">
            <attribute name="CategoryServiceNames">${Template.Service.Journal.CATEGORY_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.CATEGORY_SERVICE_NAME}</depends>
</ifdef>
            
        </service>
        
    </manager>

    <manager name="Template.Service.Journal.EditorFinder">
        
        <service name="ObjectMappedEditorFinder"
                 code="jp.ossc.nimbus.service.journal.editorfinder.ObjectMappedEditorFinderService"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME">#Editorfinder</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME">#EditorProperties</service-property>
            
<ifdef name="Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME">
            <attribute name="ParentEditorfinderServiceName">${Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME}</depends>
</ifdef>
            
<ifdef name="Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME">
            <attribute name="EditorProperties"><service-ref>${Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME}</service-ref></attribute>
            <depends>${Template.Service.Journal.EditorFinder.EDITOR_PROPERTIES_SERVICE_NAME}</depends>
</ifdef>
        </service>
        
        <service name="EditorProperties"
                 code="java.util.Properties"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME">#ObjectJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.BYTE_ARRAY_JOURNAL_EDITOR_SERVICE_NAME">#ByteArrayJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME">#ClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.ENUMERATION_JOURNAL_EDITOR_SERVICE_NAME">#EnumerationJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME">#ThrowableJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.LIST_JOURNAL_EDITOR_SERVICE_NAME">#ListJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.MAP_JOURNAL_EDITOR_SERVICE_NAME">#MapJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME">#DateJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME">#RequestJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME">#MethodJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME">#MethodCallJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME">#MethodReturnJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.METHOD_THROW_JOURNAL_EDITOR_SERVICE_NAME">#MethodThrowJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME">#DataSetJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.HEADER_JOURNAL_EDITOR_SERVICE_NAME">#HeaderJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.RECORD_JOURNAL_EDITOR_SERVICE_NAME">#RecordJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.RECORD_LIST_JOURNAL_EDITOR_SERVICE_NAME">#RecordListJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">#ServletRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">#ServletResponseJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.JOURNAL_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">#ServletResponseWrapperJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.HTTP_SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">#HttpServletRequestJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.HTTP_SESSION_JOURNAL_EDITOR_SERVICE_NAME">#HttpSessionJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.JOURNAL_HTTP_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">#HttpServletResponseWrapperJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.FACADE_VALUE_JOURNAL_EDITOR_SERVICE_NAME">#FacadeValueJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.UNIT_OF_WORK_JOURNAL_EDITOR_SERVICE_NAME">#UnitOfWorkJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.COMMAND_JOURNAL_EDITOR_SERVICE_NAME">#CommandJournalEditor</service-property>
            
            <service-property name="Template.Service.Journal.EditorFinder.DYNA_CLASS_JOURNAL_EDITOR_SERVICE_NAME">#DynaClassJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DYNA_BEAN_JOURNAL_EDITOR_SERVICE_NAME">#DynaBeanJournalEditor</service-property>
            <service-property name="Template.Service.Journal.EditorFinder.DYNA_PROPERTY_JOURNAL_EDITOR_SERVICE_NAME">#DynaPropertyJournalEditor</service-property>
            
<ifdef name="Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.lang.Object)">${Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.OBJECT_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.BYTE_ARRAY_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(byte[])">${Template.Service.Journal.EditorFinder.BYTE_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.BYTE_ARRAY_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.lang.Class)">${Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.CLASS_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.ENUMERATION_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.util.Enumeration)">${Template.Service.Journal.EditorFinder.ENUMERATION_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.ENUMERATION_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.lang.Throwable)">${Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.THROWABLE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.LIST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.util.List)">${Template.Service.Journal.EditorFinder.LIST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.LIST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.MAP_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.util.Map)">${Template.Service.Journal.EditorFinder.MAP_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.MAP_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(java.util.Date)">${Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.DATE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.RequestJournal)">${Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.MethodJournalData)">${Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.METHOD_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.MethodCallJournalData)">${Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.METHOD_CALL_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.MethodReturnJournalData)">${Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.METHOD_RETURN_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.METHOD_THROW_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.MethodThrowJournalData)">${Template.Service.Journal.EditorFinder.METHOD_THROW_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.METHOD_THROW_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.beans.dataset.DataSet)">${Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.DATASET_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.HEADER_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.beans.dataset.Header)">${Template.Service.Journal.EditorFinder.HEADER_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.HEADER_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.RECORD_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.beans.dataset.Record)">${Template.Service.Journal.EditorFinder.RECORD_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.RECORD_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.RECORD_LIST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.beans.dataset.RecordList)">${Template.Service.Journal.EditorFinder.RECORD_LIST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.RECORD_LIST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(javax.servlet.ServletRequest)">${Template.Service.Journal.EditorFinder.SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(javax.servlet.ServletResponse)">${Template.Service.Journal.EditorFinder.SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.JOURNAL_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.JournalServletResponseWrapper)">${Template.Service.Journal.EditorFinder.JOURNAL_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.JOURNAL_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.HTTP_SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(javax.servlet.http.HttpServletRequest)">${Template.Service.Journal.EditorFinder.HTTP_SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.HTTP_SERVLET_REQUEST_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.HTTP_SESSION_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(javax.servlet.http.HttpSession)">${Template.Service.Journal.EditorFinder.HTTP_SESSION_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.HTTP_SESSION_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.JOURNAL_HTTP_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.service.journal.editor.JournalHttpServletResponseWrapper)">${Template.Service.Journal.EditorFinder.JOURNAL_HTTP_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.JOURNAL_HTTP_SERVLET_RESPONSE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.FACADE_VALUE_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.ioc.FacadeValue)">${Template.Service.Journal.EditorFinder.FACADE_VALUE_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.FACADE_VALUE_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.UNIT_OF_WORK_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.ioc.UnitOfWork)">${Template.Service.Journal.EditorFinder.UNIT_OF_WORK_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.UNIT_OF_WORK_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.COMMAND_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(jp.ossc.nimbus.ioc.Command)">${Template.Service.Journal.EditorFinder.COMMAND_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.COMMAND_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.DYNA_CLASS_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(org.apache.commons.beanutils.DynaClass)">${Template.Service.Journal.EditorFinder.DYNA_CLASS_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.DYNA_CLASS_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.DYNA_BEAN_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(org.apache.commons.beanutils.DynaBean)">${Template.Service.Journal.EditorFinder.DYNA_BEAN_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.DYNA_BEAN_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
<ifdef name="Template.Service.Journal.EditorFinder.DYNA_PROPERTY_JOURNAL_EDITOR_SERVICE_NAME">
            <attribute name="Property(org.apache.commons.beanutils.DynaProperty)">${Template.Service.Journal.EditorFinder.DYNA_PROPERTY_JOURNAL_EDITOR_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.DYNA_PROPERTY_JOURNAL_EDITOR_SERVICE_NAME}</depends>
</ifdef>
        </service>
        
        <service name="RegexClassMappedEditorFinder"
                 code="jp.ossc.nimbus.service.journal.editorfinder.RegexClassMappedEditorFinderService"
                 instance="template">
            
            <service-property name="Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME">#Editorfinder</service-property>
            
<ifdef name="Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME">
            <attribute name="ParentEditorfinderServiceName">${Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.EditorFinder.PARENT_EDITOR_FINDER_SERVICE_NAME}</depends>
</ifdef>
        </service>
        
    </manager>

    <manager name="Template.Service.Journal.JournalEditor">
        
        <manager-property name="Template.Service.Journal.JournalEditor.INDENT">"    "</manager-property>
        <manager-property name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">true</manager-property>
        
        <service name="BeanJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.BeanJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ByteArrayJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ByteArrayJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ClassJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ClassJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="CommandJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.CommandJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="DataSetJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DataSetJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="DateJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DateJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="DynaBeanJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaBeanJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="DynaClassJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaClassJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="DynaPropertyJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaPropertyJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="EnumerationJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.EnumerationJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="FacadeValueJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.FacadeValueJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="FormatConvertJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.FormatConvertJournalEditorService"
                 instance="template">
            
            <service-property name="Template.Service.Journal.JournalEditor.FORMAT_CONVERTER_SERVICE_NAME" extends="true">#FormatConverter</service-property>
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.FORMAT_CONVERTER_SERVICE_NAME">
            <attribute name="FormatConverterServiceName">${Template.Service.Journal.JournalEditor.FORMAT_CONVERTER_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.JournalEditor.FORMAT_CONVERTER_SERVICE_NAME}</depends>
</ifdef>
        </service>
        
        <service name="HeaderJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HeaderJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="HttpServletRequestJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletRequestJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="HttpServletResponseWrapperJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletResponseWrapperJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="HttpSessionJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpSessionJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ListJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ListJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MapJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MethodCallJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodCallJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MethodJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MethodReturnJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodReturnJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MethodThrowJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodThrowJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="MutableObjectJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MutableObjectJournalEditorService"
                 instance="template"/>
        
        <service name="ObjectArrayJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ObjectArrayJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ObjectJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ObjectJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ObjectKeyMapEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ObjectKeyMapEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="RecordJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.RecordJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="RecordListJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.RecordListJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ServletRequestJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletRequestJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ServletResponseJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ServletResponseWrapperJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseWrapperJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="SimpleRequestJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.SimpleRequestJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="ThrowableJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ThrowableJournalEditorService"
                 instance="template">
            
            <service-property name="Template.Service.Journal.JournalEditor.ThrowableJournalEditorService.THREAD_CONTEXT_SERVICE_NAME">#ThreadContext</service-property>
            
<ifdef name="Template.Service.Journal.JournalEditor.ThrowableJournalEditorService.THREAD_CONTEXT_SERVICE_NAME">
            <attribute name="ThreadContextServiceName">${Template.Service.Journal.JournalEditor.ThrowableJournalEditorService.THREAD_CONTEXT_SERVICE_NAME}</attribute>
            <depends>${Template.Service.Journal.JournalEditor.ThrowableJournalEditorService.THREAD_CONTEXT_SERVICE_NAME}</depends>
</ifdef>
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
        <service name="UnitOfWorkJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.UnitOfWorkJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
        </service>
        
    </manager>
    
    <manager name="Template.Service.Journal.JournalEditor.CSV">
        
        <manager-property name="Template.Service.Journal.JournalEditor.INDENT">"    "</manager-property>
        <manager-property name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">true</manager-property>
        <manager-property name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">,</manager-property>
        
        <service name="DynaBeanCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaBeanCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="DynaClassCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaClassCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="DynaPropertyCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaPropertyCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="HttpServletRequestCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletRequestCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="HttpServletResponseWrapperCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletResponseWrapperCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="HttpSessionCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpSessionCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="MethodCallCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodCallCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="MethodReturnCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodReturnCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="MethodThrowCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodThrowCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="ServletRequestCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletRequestCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="ServletResponseCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="ServletResponseWrapperCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseWrapperCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
        <service name="SimpleRequestCSVJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.SimpleRequestCSVJournalEditorService"
                 instance="template">
            
<ifdef name="Template.Service.Journal.JournalEditor.OUTPUT_INDENT">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.OUTPUT_INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.INDENT">
            <attribute name="Indent">${Template.Service.Journal.JournalEditor.INDENT}</attribute>
</ifdef>
<ifdef name="Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR">
            <attribute name="OutputIndent">${Template.Service.Journal.JournalEditor.CSV.CSV_SEPARATOR}</attribute>
</ifdef>
        </service>
        
    </manager>
    
    <manager name="Template.Service.Journal.JournalEditor.Map">
        
        <service name="DynaBeanMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaBeanMapJournalEditorService"
                 instance="template"/>
        
        <service name="DynaClassMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DynaClassMapJournalEditorService"
                 instance="template"/>
        
        <service name="HttpServletRequestMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletRequestMapJournalEditorService"
                 instance="template"/>
        
        <service name="HttpServletResponseWrapperMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletResponseWrapperMapJournalEditorService"
                 instance="template"/>
        
        <service name="HttpSessionMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpSessionMapJournalEditorService"
                 instance="template"/>
        
        <service name="ServletRequestMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletRequestMapJournalEditorService"
                 instance="template"/>
        
        <service name="ServletResponseMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseMapJournalEditorService"
                 instance="template"/>
        
        <service name="ServletResponseWrapperMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletResponseWrapperMapJournalEditorService"
                 instance="template"/>
        
        <service name="SimpleRequestMapJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.SimpleRequestMapJournalEditorService"
                 instance="template"/>
        
    </manager>
    
    <manager name="Template.Service.Journal.JournalEditor.JSON">
        
        <service name="BeanJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.BeanJSONJournalEditorService"
                 instance="template"/>
        
        <service name="DataSetJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.DataSetJSONJournalEditorService"
                 instance="template"/>
        
        <service name="HttpServletRequestJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpServletRequestJSONJournalEditorService"
                 instance="template"/>
        
        <service name="HttpSessionJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.HttpSessionJSONJournalEditorService"
                 instance="template"/>
        
        <service name="JournalHttpServletResponseWrapperJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.JournalHttpServletResponseWrapperJSONJournalEditorService"
                 instance="template"/>
        
        <service name="JournalServletResponseWrapperJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.JournalServletResponseWrapperJSONJournalEditorService"
                 instance="template"/>
        
        <service name="JSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.JSONJournalEditorService"
                 instance="template"/>
        
        <service name="MethodCallJournalJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodCallJournalJSONJournalEditorService"
                 instance="template"/>
        
        <service name="MethodJournalJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodJournalJSONJournalEditorService"
                 instance="template"/>
        
        <service name="MethodReturnJournalJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodReturnJournalJSONJournalEditorService"
                 instance="template"/>
        
        <service name="MethodThrowJournalJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.MethodThrowJournalJSONJournalEditorService"
                 instance="template"/>
        
        <service name="RequestJournalJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.RequestJournalJSONJournalEditorService"
                 instance="template"/>
        
        <service name="ServletRequestJSONJournalEditor"
                 code="jp.ossc.nimbus.service.journal.editor.ServletRequestJSONJournalEditorService"
                 instance="template"/>
        
    </manager>

</server>